!function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=10)}([function(e,t){e.exports=require("before-hook")},function(e,t){e.exports=require("express")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UsersDBLibInit=t.SubscriptionsDBLibInit=void 0;var r=i(s(15)),n=i(s(16));function i(e){return e&&e.__esModule?e:{default:e}}t.SubscriptionsDBLibInit=r.default,t.UsersDBLibInit=n.default},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(17).cognito.APP_CLIENT_ID;t.default=(({jwt_decode:e})=>{if(!e)throw ReferenceError("package jwt_decode is required.");return{UNSAFE_BUT_FAST_handler:(t,s,n)=>{try{const s=t.headers&&t.headers.Authorization?t.headers.Authorization:".",i=e(s);return i&&i.exp&&i.aud?Math.floor(new Date/1e3)>i.exp?n("invalid a"):i.aud!==r?n("invalid b"):n(null,i):n("invalid c")}catch(e){const t=e&&e.message?`${e.message}`:e;return n(t,t)}}}})},function(e,t){e.exports=require("util")},function(e,t){e.exports=require("jwt-decode")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseMiddleware=t.AuthMiddleware=void 0;var r,n=s(18),i=(r=n)&&r.__esModule?r:{default:r};const{BaseMiddleware:o}=s(0);t.AuthMiddleware=i.default,t.BaseMiddleware=o},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const{Session:r,Subscription:n,User:i,UserSubscription:o,sequelize:u,Sequelize:a}=s(19);t.Session=r,t.Subscription=n,t.User=i,t.UserSubscription=o,t.sequelize=u,t.Sequelize=a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.format_response=(e=>{let t=200,s=e;return e instanceof Error&&(t=500,s=e.message?e.message:e),e&&void 0!==e.statusCode&&e.statusCode>=400&&e.statusCode<=499&&(t=e.statusCode),{statusCode:t,headers:{"Access-Control-Allow-Origin":"*"},body:"string"==typeof s?s:JSON.stringify(s)}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsKMSInit=t.recurly=void 0;var r=o(s(25)),n=o(s(26)),i=o(s(29));function o(e){return e&&e.__esModule?e:{default:e}}const u=(0,n.default)(r.default);t.recurly=u,t.AwsKMSInit=i.default},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(s(11)),n=i(s(12));function i(e){return e&&e.__esModule?e:{default:e}}const o=r.default.createServer(n.default);t.default=((e,t)=>r.default.proxy(o,e,t))},function(e,t){e.exports=require("aws-serverless-express")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=s(1),i=(r=n)&&r.__esModule?r:{default:r},o=s(13);const u=s(37),a=(0,i.default)();a.use(u()),a.use(i.default.json()),a.use("/users",o.users),a.get("/",(e,t)=>t.send("Hello world ttt !")),a.use(function(e,t,s,r){return console.log("At error handler middleware"),console.log(e),"UnauthorizedError"===e.name?s.status(401).send(e.message):"NotFoundError"===e.name?s.status(404).send(e.message):"ValidationError"===e.name?s.status(403).send(e):"ForbiddenError"===e.name?s.status(403).send(e.message):s.status(500).send({msg:"Internal server error"})}),t.default=a},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.users=t.subscription=t.dashboard=void 0;var r=o(s(14)),n=o(s(35)),i=o(s(36));function o(e){return e&&e.__esModule?e:{default:e}}t.dashboard=r.default,t.subscription=n.default,t.users=i.default},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=s(2),i=s(3),o=(r=i)&&r.__esModule?r:{default:r};const{promisify:u}=s(4),{CreateInstance:a}=s(0),c=s(1).Router(),l=s(5),{AuthMiddleware:d,BaseMiddleware:f}=s(6),{Session:p,Subscription:_,User:b,UserSubscription:y}=s(7),{seedSubscription:g}=s(33),{UNSAFE_BUT_FAST_handler:S}=(0,o.default)({jwt_decode:l}),h=(0,n.SubscriptionsDBLibInit)({User:b,UserSubscription:y,Subscription:_}),{format_response:m}=s(8),w=a({configure:{augmentMethods:{onCatch:(...e)=>{const{arg:t={},getParams:s}=e[1],[r,n]=s(),i=Object.assign({},t,{headers:{"Access-Control-Allow-Origin":"*"}});return n&&n.json?n.json(i):i}}}}),v=e=>w(u(e)).use(d({promisify:u,cognitoJWTDecodeHandler:S})),O=v(async(e,t)=>{const{body:s={}}=e,r={};try{if(s&&!0===s.view)r.user=await b.findAll(),r.subscription=await _.findAll(),r.userSubscription=await y.findAll();else if(!0===s.resetAll)await b.sync({force:!0}),await p.sync({force:!0}),await _.sync({force:!0}),await y.sync({force:!0}),await g(_);else if(!0===s.seed)await g(_);else if("string"==typeof s.syncOne){const e=!0===s.syncForce;switch(s.syncOne){case"UserSubscription":r[`synced ${s.syncOne}`]=await y.sync({force:e});break;case"Subscription":r[`synced ${s.syncOne}`]=await _.sync({force:e});break;case"User":r[`synced ${s.syncOne} ${e}`]=await b.sync({force:e})}}return t.json(m({message:`300 - syncOne 1 ${s.syncOne} ${s.syncForce}`,res:r}))}catch(e){return t.json(m({message:"Err 300 - syncOne 1",msg:e&&e.message?e.message:"somethingwentwrong"}))}}).use(f({handler:({getParams:e,getHelpers:t})=>{const{returnAndSendResponse:s}=t(),[r]=e();return r.user&&"1897f1a5-ceea-4de9-a186-d2d2433bb7cc"===r.user.sub?{}:s({statusCode:403,body:"Invalid Session",headers:{"Access-Control-Allow-Origin":"*"}})}})),A=v(async(e,t)=>{try{const e=await h.getUserSubscriptions({dashboard:!0});return t.json(m(e))}catch(e){return t.json(m(e))}}),j=v(async(e,t)=>{try{const e=await b.findAll({attributes:["user_id","email","is_active","createdAt"]});return t.json(m(e))}catch(e){return t.json(m(e))}}),M=v(async(e,t)=>{try{const e=await _.findAll({});return t.json(m(e))}catch(e){return t.json(m(e))}});c.post("/migration",O),c.get("/getUserSubscriptions",A),c.get("/getUsers",j),c.get("/getSubscriptions",M),t.default=c},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(({User:e,UserSubscription:t,Subscription:s})=>{if(void 0===s||void 0===e||void 0===t)throw Error(`Model can't be undefined. type ${s} - type ${e} - type ${t}`);return{getUserSubscriptions:async r=>{const n="object"==typeof r&&!0===r.dashboard,i=[{model:s,as:"subscription",attributes:["subscription_type"]}];if(!0===n)return t.findAll({attributes:{exclude:["user_data"]},include:[{model:e,as:"user",attributes:["email"]},...i]});const o=await e.findOne({where:{user_id_cognito_sub:r}});if(o&&o.user_id)return t.findAll({attributes:{exclude:["user_data"]},where:{user_id:o.user_id},include:i});throw Error("Cannot subscribe. Invalid user.")},subscribe:async({userSub:r,planCode:n})=>{const i=await e.findOne({where:{user_id_cognito_sub:r}}),o=await s.findOne({where:{subscription_type:n}});if(!o||!o.subscription_id)throw Error("Cannot subscribe. Invalid plan code.");if(i&&i.user_id){if(await t.findOne({where:{subscription_id:o.subscription_id,user_id:i.user_id}}))throw Error("Invalid action. User already subscribed.");return()=>t.create({user_data:JSON.stringify(i),user_id:i.user_id,subscription_id:o.subscription_id},{include:[{model:e,as:"user"},{model:s,as:"subscription"}]})}throw Error("Cannot subscribe. Invalid user.")}}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(({User:e,Session:t})=>{if(void 0===e||void 0===t)throw ReferenceError(`Model cant be undefined. type is ${typeof e} type is ${typeof t}`);return{logSessionUponLogin:async(s,r)=>{const n=await e.findOne({user_id_cognito_sub:r.sub});return n&&n.user_id?t.update({data:s},{where:{session_id:n.session_id}}):e.create({data:JSON.stringify(r),email:r.email,user_id_cognito_sub:r.sub,session:{data:s,user_data:JSON.stringify(r)}},{include:[{model:t,as:"session"}]})}}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.cognito={REGION:"ap-southeast-2",USER_POOL_ID:"ap-southeast-2_3hm8LqDBX",APP_CLIENT_ID:"3l37srp044f7r1gnge39bkbsok"}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const{BaseMiddleware:r}=s(0);t.default=(({promisify:e,cognitoJWTDecodeHandler:t}={})=>{if(e&&"function"!=typeof e||t&&"function"!=typeof t)throw Error(`invalid (promisify and cognitoJWTDecodeHandler) passed. ${typeof e},  ${typeof t}`);return r({configure:{augmentMethods:{onCatch:(...e)=>{const{prevRawMethod:t}=e[1];return t({statusCode:403,body:"Invalid Session",headers:{"Access-Control-Allow-Origin":"*"}})}}},handler:async({getParams:s,getHelpers:r})=>{const[n,i]=s(),{returnAndSendResponse:o}=r();if(!n||!n.headers)return{};const u={...n.headers};u.Authorization||(u.Authorization=u.authorization);let a=t;(e=>"AsyncFunction"===e.constructor.name)(a)||(a=e(a));const c=await a(Object.assign({},n,{headers:u}),i);return c&&"string"==typeof c.sub?(n.user=c,n.authToken=u.Authorization,{}):o({statusCode:403,body:"Invalid Session",headers:{"Access-Control-Allow-Origin":"*"}})}})})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sequelize=t.sequelize=t.UserSubscription=t.User=t.Subscription=t.Session=void 0;var r=c(s(20)),n=c(s(21)),i=c(s(22)),o=c(s(23)),u=c(s(24)),a=s(9);function c(e){return e&&e.__esModule?e:{default:e}}const l=s(31),{getPw:d}=(s(32),(0,a.AwsKMSInit)({aws:u.default})),{PG_DATABASE:f,PG_USER:p,PG_HOST:_,PG_PORT:b,PG_PASSWORD:y}=process.env,g=new l(`${f}`,`${p}`,`${y}`,{dialect:"postgres",host:`${_}`,port:`${b}`,logging:!1,define:{charset:"utf8",collate:"utf8_general_ci"},pool:{max:5,min:0,idle:2e4,handleDisconnects:!0},dialectOptions:{requestTimeout:1e5}}),S=(0,n.default)({sequelize:g,Sequelize:l}),h=(0,i.default)({sequelize:g,Sequelize:l}),m=(0,r.default)({sequelize:g,Sequelize:l},{Session:S}),w=(0,o.default)({sequelize:g,Sequelize:l});h.belongsToMany(m,{through:w,as:"user",foreignKey:"subscription_id"}),m.belongsToMany(h,{through:w,as:"user_subscription",foreignKey:"user_id"}),w.belongsTo(m,{as:"user",foreignKey:"user_id"}),w.belongsTo(h,{as:"subscription",foreignKey:"subscription_id"}),console.log("you got",r.default.toString()),console.log("your models are",g.models),t.Session=S,t.Subscription=h,t.User=m,t.UserSubscription=w,t.sequelize=g,t.Sequelize=l},function(e,t,s){"use strict";s.r(t),t.default=(({sequelize:e,Sequelize:t},{Session:s})=>{if(!e||!t)throw Error(`sequelize Sequelize are required.\n        typeof ${e},\n        typeof ${t}`);const{Model:r}=t;class n extends r{}return n.init({user_id:{type:t.INTEGER,allowNull:!1,primaryKey:!0,autoIncrement:!0},user_id_cognito_sub:{type:t.STRING(255),allowNull:!1,unique:!0},email:{type:t.STRING(255),allowNull:!1},is_active:{type:t.BOOLEAN,allowNull:!1,defaultValue:!1},data:{type:t.TEXT,allowNull:!1}},{timestamps:!0,sequelize:e}),n.belongsTo(s,{as:"session",foreignKey:{name:"session_id",unique:!0}}),n})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(({sequelize:e,Sequelize:t})=>{if(!e||!t)throw Error(`sequelize Sequelize are required.\n        typeof ${e},\n        typeof ${t}`);const{Model:s}=t;class r extends s{}return r.init({session_id:{type:t.INTEGER,allowNull:!1,primaryKey:!0,autoIncrement:!0},data:{type:t.TEXT,allowNull:!1},user_data:{type:t.TEXT,allowNull:!1}},{timestamps:!0,sequelize:e}),r})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(({sequelize:e,Sequelize:t})=>{if(!e||!t)throw Error(`sequelize Sequelize are required.\n        typeof ${e},\n        typeof ${t}`);const{Model:s}=t;class r extends s{}return r.init({subscription_id:{allowNull:!1,type:t.INTEGER,primaryKey:!0,autoIncrement:!0},subscription_type:{type:t.STRING(255),allowNull:!1},data:{type:t.TEXT,allowNull:!1}},{timestamps:!0,sequelize:e}),r})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(({sequelize:e,Sequelize:t})=>{if(!e||!t)throw Error(`sequelize Sequelize are required.\n          typeof ${e},\n          typeof ${t}`);const{Model:s}=t;class r extends s{}return r.init({user_data:{type:t.TEXT,allowNull:!1}},{timestamps:!0,sequelize:e}),r})},function(e,t){e.exports=require("aws-sdk")},function(e,t){e.exports=require("recurly-js")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=s(27),i=(r=n)&&r.__esModule?r:{default:r};const o=s(28),{getCurrencyUnit:u}=o;t.default=(e=>{if(!e||!i.default||!i.default.API_KEY)throw Error(`Recurly library and RecurlyConfig is required. type ${typeof e} - ${typeof i.default}`);const t=new e(i.default);return{getlist:e=>{t.accounts.list((t,s)=>t?e(t):e(null,s.data))},getAccount:(e,s)=>{t.accounts.get(e,(e,t)=>e?s(e):s(null,t.data))},getSubscriptions:(e,s)=>{t.subscriptions.listByAccount(e,(e,t)=>{if(e)return s(e);let r=!!(t.data&&t.data.subscriptions&&t.data.subscriptions.subscription)&&t.data.subscriptions.subscription;if(!r)return s(null,{});const n=(r=Array.isArray(r)?r:[r]).map(e=>({uuid:e.uuid,plan:e.plan.name,state:e.state,created:e.activated_at._,nextInvoice:e.current_period_ends_at._}));return s(null,n)})},subscribe:(e,s)=>{const{account_code:r="",token:n="",plan_code:i=""}=e,o={plan_code:i||"premium-plan",currency:"USD",account:{account_code:r,billing_info:{token_id:n}}};t.subscriptions.create(o,(e,t)=>e?s(e):s(null,t.data))},getPlans:e=>t.plans.list((t,s)=>{if(t)return e(t);const r=(Array.isArray(s.data.plans.plan)?s.data.plans.plan:[s.data.plans.plan]).map(e=>{const t=u(e);if(!t)return{};const s=parseFloat(e.unit_amount_in_cents[t]._)/100,r=e.plan_interval_length._>1?`${s} ${t}/${e.plan_interval_length._} ${e.plan_interval_unit}`:`${s} ${t}/${e.plan_interval_unit}`;return{name:e.name,code:e.plan_code,priceLabel:r,price:e.unit_amount_in_cents.USD._,term:Math.round(e.plan_interval_length._*e.total_billing_cycles._),termLabel:`${Math.round(e.plan_interval_length._*e.total_billing_cycles._)} ${e.plan_interval_unit}`,setupFee:e.setup_fee_in_cents,setupFeeLabel:`${parseFloat(e.setup_fee_in_cents[t]._/100)} ${t}`,trial:e.trial_interval_length._>1?`${e.trial_interval_length._} ${e.trial_interval_unit}`:"",plan:e.plan,currencySymbol:"USD"===t?"$":"Unit",description:e.description}});return e(null,r)},{})}})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={API_KEY:"2e5af7a67ff341de813d5107e9ba4969",SUBDOMAIN:"tantyrohunter",ENVIRONMENT:"sandbox",DEBUG:!0}},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.getCurrencyUnit=(e=>{if(e&&e.unit_amount_in_cents){const t=e.unit_amount_in_cents;return Object.keys(t).reduce((e,t)=>""!==e&&"$"!==t?e:"$"!==t?t:"","")}return""})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(30);t.default=(({aws:e})=>{if(!e)throw Error("package aws, crypto are required",typeof e);const t=new e.KMS,s=e=>{let t=process.env.PG_DATABASE+process.env.PG_HOST;t=r.createHash("sha256").update(String(t)).digest("base64").substr(0,32);let s="31850b5b911708f79af28613e39c7f99";s=Buffer.from(s,"hex");const n=Buffer.from(e,"hex"),i=r.createDecipheriv("aes-256-cbc",Buffer.from(t),s);let o=i.update(n);return(o=Buffer.concat([o,i.final()])).toString()};return{decrypt:s,encrypt:e=>{let t=process.env.PG_DATABASE+process.env.PG_HOST;t=r.createHash("sha256").update(String(t)).digest("base64").substr(0,32);let s="31850b5b911708f79af28613e39c7f99";s=Buffer.from(s,"hex");const n=r.createCipheriv("aes-256-cbc",Buffer.from(t),s);let i=n.update(e);return i=Buffer.concat([i,n.final()]),{iv:s.toString("hex"),encryptedData:i.toString("hex")}},getPw:()=>s("ea5f095b0fe2b893cecec7f1689f06630eb234f2f1258961d0335c152624f129"),decyptPromised:()=>new Promise((e,s)=>{t.decrypt({CiphertextBlob:Buffer.from(process.env.PG_PASSWORD,"base64")},(t,r)=>{try{const n=r.Plaintext.toString("ascii");return e(n)}catch(e){return s(t)}})})}})},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("sequelize")},function(e,t){e.exports=require("pg")},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=s(34);t.seedSubscription=r},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=(async e=>{return await e.sync({force:!0}),e.bulkCreate([{subscription_type:"basic-plan",data:JSON.stringify({id:"someId",variable1:"some var",deeplyNest:{nested:"one"}})},{subscription_type:"private-plan",data:JSON.stringify({id:"someId2",variable1:"some var2",deeplyNest:{nested:"one2"}})},{subscription_type:"pro-plan",data:JSON.stringify({id:"someId2",variable1:"some var2",deeplyNest:{nested:"one2"}})},{subscription_type:"premium-plan",data:JSON.stringify({id:"someId2",variable1:"some var2",deeplyNest:{nested:"one2"}})}])})},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=s(2),i=s(3),o=(r=i)&&r.__esModule?r:{default:r};const{promisify:u}=s(4),{CreateInstance:a}=s(0),c=s(1).Router(),l=s(5),{AuthMiddleware:d}=s(6),{Session:f,Subscription:p,User:_,UserSubscription:b}=s(7),{UNSAFE_BUT_FAST_handler:y}=(0,o.default)({jwt_decode:l}),{format_response:g}=s(8),{recurly:S}=s(9),{getUserSubscriptions:h}=(0,n.SubscriptionsDBLibInit)({User:_,Subscription:p,UserSubscription:b}),m=a({configure:{augmentMethods:{onCatch:(...e)=>{const{arg:t={},getParams:s}=e[1],r=Object.assign({},t,{headers:{"Access-Control-Allow-Origin":"*"}});return s&&s()[1]&&"function"==typeof s()[1].json?s()[1].json(t):r}}}}),w=e=>m(u(e)).use(d({promisify:u,cognitoJWTDecodeHandler:y})),v=w(async(e,t,s)=>{try{const e=u(S.getlist),s=await e();return t.json({data:s})}catch(e){return t.json(g(e))}}),O=w(async(e,t)=>{try{const s=u(S.getAccount),r=await s(e.user.sub);return t.json(g(r))}catch(e){return t.json(g(e))}}),A=w(async(e,t)=>{try{const{body:s={}}=e;let r=()=>{};s.account_code=e.user.sub;const i=(0,n.SubscriptionsDBLibInit)({User:_,UserSubscription:b,Subscription:p});try{r=await i.subscribe({userSub:e.user.sub,planCode:s.plan_code})}catch(e){return t.json(g({statusCode:422,headers:{"Access-Control-Allow-Origin":"*"},body:JSON.stringify({e:e&&e.message})}))}const o={};return o&&o.subscription&&o.subscription.uuid?(await r(),t.json(g({success:!0,uuid:o.subscription.uuid}))):t.json(g({statusCode:500,msg:"failure"}))}catch(e){return t.json(g(e))}}),j=w(async(e,t)=>{try{const e=u(S.getPlans),s=await e();return t.json(g(s))}catch(e){return t.json(g(e))}}),M=w(async(e,t)=>{try{const s=await h(e.user.sub);return t.json(g(s))}catch(e){return t.json(g(e))}});c.get("/getAccount",O),c.get("/getList",v),c.post("/subscribe",A),c.get("/getPlans",j),c.get("/getSubscriptions",M),t.default=c},function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,n=s(2),i=s(3),o=(r=i)&&r.__esModule?r:{default:r},u=s(6);const{promisify:a}=s(4),{CreateInstance:c}=s(0),l=s(1).Router(),d=s(5),{Session:f,Subscription:p,User:_,UserSubscription:b,sequelize:y}=s(7),{UNSAFE_BUT_FAST_handler:g}=(0,o.default)({jwt_decode:d}),{format_response:S}=s(8),h=c({configure:{augmentMethods:{onCatch:(...e)=>{const{arg:t,getParams:s=(()=>{})}=e[1],[r,n={}]=s(),i={...t,headers:{"Access-Control-Allow-Origin":"*"}};return"function"==typeof n.json?n.json(i):i}}}}),m=(e=>h(a(e)).use((0,u.AuthMiddleware)({promisify:a,cognitoJWTDecodeHandler:g})))(async(e,t)=>{try{if(_)return console.log("findinallehere",y.models),await _.sync(),await _.findAll({});const s=(0,n.UsersDBLibInit)({User:_,Session:f});return await s.logSessionUponLogin(e.authToken,e.user),t.json(S({logged:!0}))}catch(e){return console.log("ee!!",e),t.json(S(e))}});l.post("/logSessionUponLogin",m),t.default=l},function(e,t){e.exports=require("cors")}]);